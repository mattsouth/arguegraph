<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Arguegraph :: Random</title>

  <script type="text/javascript" src="js/vis.min.js"></script>
  <script type="text/javascript" src="js/graphs.js"></script>
  <script type="text/javascript" src="js/arguegraph.js"></script>
  <link href="css/vis.min.css" rel="stylesheet" type="text/css" />

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <style type="text/css">
    #mynetwork {
      height: 260px;
      border: 1px solid lightgray;
    }
    @media (min-width: 768px) {
      #mynetwork {
        height: 400px;
      }
    }
  </style>
</head>
<body>
<div class="container">
  <div class="row">
    <ol class="breadcrumb" style="margin-bottom:10px;">
      <li><a href="index.html">Arguegraph Demos</a></li>
      <li class="active">Random</li>
      <div class="pull-right">
        <div class="pull-right">
          <button type="button" class="btn btn-default btn-xs" id="share-graph" data-toggle="modal" data-target="#sharingModal">Share <span class="glyphicon glyphicon-share" aria-hidden="true"></span></button>
        </div>
      </div>
    </ol>
  </div>
  <div class="row">
    <div class="col-sm-6">
      <p>
        <a class="btn btn-default btn-sm pull-right" onclick="javascript:redraw()"><span class="glyphicon glyphicon-refresh" aria-hidden="true"></span></a>
        <span class="hidden-xs">Abstract argumentation considers an argument framework to be a
          directed graph where nodes represent arguments and edges represent conflicts between the
          arguments. The arguegraph javascript library allows you calculate extensions
          or sets of arguments that defend themselves with different criteria.</span> This demo allows you to
          generate a randomly connected graph of a particular size and connected-ness.
      </p>
    </div>
    <div class="col-sm-6">
      <label for="num-nodes">Size:</label>
      <input id="num-nodes" name="num-nodes" type="number" class="form-control input-sm" onchange="javascript:redraw()">
      <label for="degree-connected">Connectivity:</label>
      <select id="degree-connected" name="degree-connected" class="form-control input-sm" onchange="javascript:redraw()" style="margin-bottom: 5px">
        <option value="0.05">5 %</option>
        <option value="0.1">10 %</option>
        <option value="0.15">15 %</option>
        <option value="0.2">20 %</option>
      </select>
    </div>
  </div>
  <!-- begin arguegraph viewer -->
  <div class="row">
    <div class="col-xs-12">
      <div id="mynetwork" style="margin-bottom: 5px"></div>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-6">
      <select id="semantics-options">
      </select>
    </div>
    <div class="col-xs-6" id="extensions">
      <div class="pull-right">
        <button type="button" class="btn btn-default btn-xs" onclick="javascript:extdown()"> &lt; </button>
        <span id="extension"></span>
        <button type="button" class="btn btn-default btn-xs" onclick="javascript:extup()"> &gt; </button>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-12">
      <p id="semantics-description"></p>
    </div>
  </div>
  <!-- end arguegraph viewer-->
</div>

<!-- Modal -->
<div class="modal fade" id="sharingModal" tabindex="-1" role="dialog" aria-labelledby="Show url to share argument framework">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Share argument framework</h4>
      </div>
      <div class="modal-body">
        Use this <a id="share-url">link</a> to share this argument framework.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script type="text/javascript" src="js/arguegraph.vis.js"></script>
<script type="text/javascript">
  let index = 0;
  let num_nodes = 10;
  let degree_connected = 0.1;

  // generates fully connected argument framework defeatMap
  // with num nodes, connected to a degree percentage of fully connected
  // returns labelMap
  function generate(num, degree) {
    if (degree<0 || degree>1) {
      throw new Error('degree must be in the range 0-1');
    }
    map = {};
    let it = 0;
    // create nodes and connect them to the group
    for (i=0; i<num; i++) {
      let node = getLabel(i+1);
      map[node] = [];
      if (i>0) {
        let other = getLabel(Math.floor(Math.random()*i)+1);
        if (Math.random()>0.5) {
          map[other].push(node);
        } else {
          map[node].push(other);
        }
        it++;
      }
    }
    let total = Math.floor(num*num*degree);
    // add any extra nodes, if needed
    while (it<total) {
      let source = getLabel(Math.floor(Math.random()*num)+1);
      let target = getLabel(Math.floor(Math.random()*num)+1);
      if (map[source].indexOf(target)==-1) {
        map[source].push(target);
        it++;
      }
    }
    return map;
  }

  function showGenerateParameters() {
    $('#num-nodes').val(num_nodes);
    $('#degree-connected').val(degree_connected);
  }

  function draw() {
    network.unselectAll();
    // update graph coloring
    let map = networkToMap(); // defeat map of node ids
    let af = new ArgumentFramework(map);
    let reasoner = new window[semantics[semantics_selected].reasoner](af);
    let start = new Date()
    console.log('starting ', semantics_selected, ' reasoner');
    extensions = reasoner.extensions();
    console.log(extensions.length, ' extension' + (extensions.length!=1 ? 's' : '')+ ' found in ', (new Date().getTime()-start.getTime()), ' millis');
    extension_index = (extensions.length>0) ? 0 : -1;
    let extension = (extensions.length>0) ? extensions[0] : [];
    showExtensionIndex();
    showGenerateParameters();
    for (node in map) {
      nodes.update({id: node, border: 'grey', color: {background: (extension.indexOf(node)>-1?'yellow':'red'), border: 'grey', highlight:{background: (extension.indexOf(node)>-1?'gold':'tomato'), border: 'gray'}}});
    }
  }

  // a lightweight version of draw() for when the selected extension changes (but the graph remains the same)
  // called by extUp/extDown
  function update() {
    network.unselectAll();
    let extension = extensions[extension_index];
    showExtensionIndex();
    for (node in networkToMap()) {
      nodes.update({id: node, border: 'grey', color: {background: (extension.indexOf(node)>-1?'yellow':'red'), border: 'grey', highlight:{background: (extension.indexOf(node)>-1?'gold':'tomato'), border: 'gray'}}});
    }
  }

  function redraw() {
    nodes.clear();
    edges.clear();
    num_nodes = $('#num-nodes').val();
    degree_connected = $('#degree-connected').val();
    let generated = generate(num_nodes, degree_connected);
    setNodesAndEdgesFromLabelNetwork(generate(num_nodes, degree_connected));
    draw();
    let url = window.location.origin + window.location.pathname.replace('random','test') + "?" + encodeURIComponent(JSON.stringify(networkToLabelMap()));
    $('#share-url').attr('href', url);
  }

  setNodesAndEdgesFromLabelNetwork(generate(num_nodes, degree_connected));
  let network = new vis.Network(
    document.getElementById('mynetwork'),
    {nodes: nodes, edges: edges},
    network_options
  );
  function selectSemantics(choice) {
    semantics_selected = choice;
    extension_index=0;
    $('#semantics-description').text(semantics[choice].description);
    if (semantics[choice].multi) {
      $('#extensions').removeClass('hidden');
    } else {
      $('#extensions').addClass('hidden');
    }
    draw();
  }
  document.getElementById('semantics-options').onchange=function(event) {
    selectSemantics(event.target.value);
  };
  $('#semantics-options').val('grounded').change();
  let url = window.location.origin + window.location.pathname.replace('random','test') + "?" + encodeURIComponent(JSON.stringify(networkToLabelMap()));
  $('#share-url').attr('href', url);

  </script>

</body>
</html>
