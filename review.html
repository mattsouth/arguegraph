<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Arguegraph :: Review</title>

  <script type="text/javascript" src="js/vis.min.js"></script>
  <script type="text/javascript" src="js/graphs.js"></script>
  <script type="text/javascript" src="js/arguegraph.js"></script>
  <link href="css/vis.min.css" rel="stylesheet" type="text/css" />

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <style type="text/css">
    #mynetwork {
      height: 260px;
      border: 1px solid lightgray;
    }

    @media (min-width: 768px) {
      #mynetwork {
        height: 400px;
      }
    }
  </style>
</head>
<body>
<div class="container">
  <div class="row">
    <ol class="breadcrumb" style="margin-bottom:10px">
      <li><a href="index.html">Arguegraph</a></li>
      <li class="active">Review</li>
      <div class="pull-right">
        <a class="btn btn-default btn-xs" onclick="javascript:down()"> &lt; </a>
        <span class="position"></span>
        <a class="btn btn-default btn-xs" onclick="javascript:up()"> &gt; </a>
      </div>
    </ol>
  </div>
  <div class="row">
    <div class="col-xs-12">
      <p>
        <span class="hidden-xs">Abstract argumentation considers an argument framework to be a
          directed graph where nodes represent arguments and edges represent conflicts between the
          arguments. The arguegraph javascript library allows you calculate extensions
        or sets of arguments that defend themselves with different criteria.</span>This demo allows you to review the different
        extensions for all the distinct directed graphs with up to three nodes.
      </p>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-12">
      <div id="mynetwork" style="margin-bottom: 5px"></div>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-6">
      <select id="semantics-options">
      </select>
    </div>
    <div class="col-xs-6" id="extensions">
      <div class="pull-right">
        <button type="button" class="btn btn-default btn-xs" onclick="javascript:extdown()"> &lt; </button>
        <span id="extension"></span>
        <button type="button" class="btn btn-default btn-xs" onclick="javascript:extup()"> &gt; </button>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-12">
      <p id="semantics-description"></p>
    </div>
  </div>
</div>
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script type="text/javascript" src="js/arguegraph.vis.js"></script>
<script type="text/javascript">
  let keys = Object.keys(graphs);
  let index = 0;
  let nodes = new vis.DataSet();
  let edges = new vis.DataSet();
  let semantics_selected = null;
  let extensions = null;
  let extension_index = -1;
  // update current index in the list of available graphs
  function showIndex() {
    let positions = document.getElementsByClassName('position');
    for (let i=0; i<positions.length; i++) {
      positions[i].textContent = (index+1) + '/' + keys.length;
    }
  }
  function showExtensionIndex() {
    document.getElementById('extension').textContent = (extension_index+1) + '/' + extensions.length;
  }
  function selectSemantics(choice) {
    semantics_selected = choice;
    extension_index=0;
    $('#semantics-description').text(semantics[choice].description);
    if (semantics[choice].multi) {
      $('#extensions').removeClass('hidden');
    } else {
      $('#extensions').addClass('hidden');
    }
    draw();
  }
  function draw() {
    let test = graphs[keys[index]];
    network.unselectAll();
    showIndex();
    // update graph coloring
    let af = new ArgumentFramework(test);
    let reasoner = new window[semantics[semantics_selected].reasoner](af);
    extensions = reasoner.extensions();
    extension_index = (extensions.length>0) ? 0 : -1;
    let extension = (extensions.length>0) ? extensions[0] : [];
    showExtensionIndex();
    for (node in test) {
      nodes.update({id: node, label: String.fromCharCode('A'.charCodeAt(0) + parseInt(node)), border: 'grey', color: {background: (extension.indexOf(node)>-1?'yellow':'red'), border: 'grey'}});
      // remove unneeded attackers
      edges.get({filter: function(item){ return (item.to==node) }}).forEach(function(existing) {
        if (test[node].indexOf(existing.from)==-1) {
          edges.remove(existing.id);
        }
      });
      // add missing attackers
      test[node].forEach(function(attacker) {
        existing = edges.get({filter:function(item){ return (item.to==node && item.from==attacker) }});
        if (existing.length==0) {
          edges.add({to: node, from: attacker, arrows: 'to',color:'grey'});
        }
      });
      for (node in nodes.get()) {
        if (!test.hasOwnProperty(node)) {
          nodes.remove(node);
        }
      }
    }
  }
  // a lightweight version of draw() for when the selected extension changes (but the graph remains the same)
  function update() {
    let test = graphs[keys[index]];
    network.unselectAll();
    let extension = extensions[extension_index];
    showExtensionIndex();
    for (node in test) {
      nodes.update({id: node, label: String.fromCharCode('A'.charCodeAt(0) + parseInt(node)), border: 'grey', color: {background: (extension.indexOf(node)>-1?'yellow':'red'), border: 'grey'}});
    }
  }
  function up() {
    if (index<(keys.length-1)) {
      index++;
    } else {
      index=0;
    }
    draw();
  }
  function down() {
    if (index>0) {
      index--;
    } else {
      index=keys.length-1;
    }
    draw();
  }
  function extup() {
    if (extension_index<(extensions.length-1)) {
      extension_index++;
    } else {
      extension_index=0;
    }
    update();
  }
  function extdown() {
    if (extension_index>0) {
      extension_index--;
    } else {
      extension_index=extensions.length-1;
    }
    update();
  }
  let container = document.getElementById('mynetwork');
  let options = {};
  let network = new vis.Network(container, {nodes: nodes, edges: edges}, options);
  document.getElementById('semantics-options').onchange=function(event) {
    selectSemantics(event.target.value);
  };
  $('#semantics-options').val('grounded').change();
  draw();
</script>

</body>
</html>
