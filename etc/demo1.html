<!doctype html>
<html>
<head>
  <title>Arguejs | Demo</title>
	<link rel="stylesheet" href="/etc/css/normalize.css">
	<link rel="stylesheet" href="/etc/css/skeleton.css">
  <link rel="stylesheet" href="/etc/vis.css">
  <script type="text/javascript" src="vis.js"></script>
  <script type="text/javascript" src="../src/arguejs.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
  <style>
  #mynetwork {
    border: 1px solid lightgray;
  }
  .topline input {
    margin-top: 10px;
    margin-bottom: 12px;
  }
  .topline h4 {
    margin-top: 10px;
    margin-bottom: 0px;
  }
  </style>
</head>
<body>
<div class="container">
<div class="row topline">
  <div class="three columns"><h4>Arguejs</h4></div>
  <div class="six columns">
    <input class="u-full-width" type="text" name="argument" placeholder="New argument" id="argumentText"/>
  </div>
  <div class="three columns">
    <input type="submit" id="argumentAdd" class="button u-full-width" onclick="addArgument()" value="Add &raquo;" />
    <input type="submit" id="argumentUpdate" class="button u-full-width" style="display: none" value="Update &raquo;" />    
  </div>
</div>
<div id="mynetwork" style="margin-bottom: 10px"></div>
<div class="row">
  <div class="twelve columns">
  <button onclick="clearArguments()">clear</button>
  </div>
</div>
</div>
<script type="text/javascript">

var nodes = null;
var edges = null;
var counter = 1; // for label generation

/* see http://cwestblog.com/2013/09/05/javascript-snippet-convert-number-to-column-name/ */
function getNextLabel() {
  var num = counter;
  for (var ret = '', a = 1, b = 26; (num -= a) >= 0; a = b, b *= 26) {
    ret = String.fromCharCode(parseInt((num % b) / a) + 65) + ret;
  }
  counter++;
  nodes.forEach(function(node) {
    if (node.label==ret) {
      ret = getNextLabel();
    }
  });
  return ret;
}

function addArgument() {
  var input = $('#argumentText');
  nodes.add({id: nodes.length, label: input.val()});
  input.val(null);
}

function updateArgument(data, callback) {
  var input = $('#argumentText');
  data.label = input.val();
  input.val(null);
  $('#argumentUpdate').hide()
  $('#argumentAdd').show()  
  callback(data);
}

function clearArguments() {
  nodes.clear();
  edges.clear();
  counter = 1;
  window.network._unselectAll(false);
}

$(window).load(function(){
  nodes = new vis.DataSet()
  edges = new vis.DataSet()

  $('#mynetwork').height($(window).innerHeight()-128);

  // create a network
  var container = document.getElementById('mynetwork');
  var data = {
    nodes: nodes,
    edges: edges
  };
  var options = {
    dataManipulation: {
      enabled: true,
      initiallyVisible: true,
    },
    edges: {
      style: 'arrow'
    },
    onAdd: function(data, callback) {
      data.label = getNextLabel();
      callback(data);
    },
    onEdit: function(data,callback) {
      $('#argumentUpdate').show();
      $('#argumentAdd').hide();
      $('#argumentText').val(data.label);
      el = document.getElementById('argumentUpdate');
      // see visjs ex 21.  todo: do this with jquery
      el.onclick = updateArgument.bind(this, data, callback);
    }
  };
  window.network = new vis.Network(container, data, options);
  window.network.on('select', function(ev) {
    if (ev.nodes.length==0 && $('#argumentUpdate').is(":visible")) {
      $('#argumentUpdate').hide();
      $('#argumentUpdate').off('click');
      $('#argumentAdd').show();
      $('#argumentText').val(null);
    }
  });
});
</script>
</body>
</html>